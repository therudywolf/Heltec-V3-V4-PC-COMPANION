# Первый запуск · rudywolf

Пошаговый гайд: от нуля до работающего монитора на дисплее Heltec.

---

## Шаг 1. LibreHardwareMonitor на ПК

1. Скачай [LibreHardwareMonitor](https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/releases) и распакуй.
2. Запусти **LibreHardwareMonitor.exe**.
3. В меню: **Options → Run LibreHardwareMonitor** (чтобы работал в трее).
4. Включи веб-сервер: **Options → Remote Web Server** (порт по умолчанию 8085).
5. Проверь в браузере: `http://localhost:8085/data.json` — должен открыться JSON с метриками (дерево сенсоров с полями `SensorId`, `Value`/`RawValue`). Для работы монитора нужны сенсоры, перечисленные в `TARGETS` в `monitor.py` (например `/amdcpu/0/temperature/2`, `/gpu-nvidia/0/temperature/0`, `/ram/load/0` и т.д.).

Если порт другой — запомни его, он понадобится в `.env` как `LHM_URL`.

---

## Шаг 2. Клонирование и конфиг проекта

1. Открой папку проекта (например `Heltec v4` или `rudywolf`).
2. Создай конфиг из шаблона:

   ```bash
   copy .env.example .env
   ```

3. Открой `.env` в блокноте. Основные параметры:

   | Переменная | Значение                          | Описание                                                                    |
   | ---------- | --------------------------------- | --------------------------------------------------------------------------- |
   | `LHM_URL`  | `http://localhost:8085/data.json` | URL JSON от LibreHardwareMonitor                                            |
   | `TCP_PORT` | `8888`                            | Порт TCP-сервера (к нему подключается плата)                                |
   | `PC_IP`    | IP твоего ПК в сети               | Нужен только для справки; в плату вписывается отдельно в `config_private.h` |

   Узнать IP ПК: в cmd выполни `ipconfig`, смотри «IPv4-адрес» нужного адаптера (WiFi или Ethernet).

---

## Шаг 3. Установка зависимостей и запуск монитора

1. Открой терминал (cmd или PowerShell) в папке проекта.
2. Установи зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Запусти сервер:

   ```bash
   python monitor.py
   ```

4. В консоли должно появиться что-то вроде:

   ```
   [INIT] Запуск мониторинга...
   [*] TCP: 0.0.0.0:8888
   ```

   На Windows в системном трее появится иконка «Heltec Monitor»; выход — правый клик по иконке → Выход. Окно консоли не закрывай — монитор ждёт подключения платы.

   **Вместо Python можно собрать один EXE:** выполни `build_oneclick.bat` — создастся `.venv`, установятся все зависимости и PyInstaller, соберётся `monitor.exe` в корень проекта. Положи рядом `.env` и запускай `monitor.exe`; окна консоли не будет, только иконка в трее.

---

## Шаг 4. Подготовка платы Heltec

1. Скопируй конфиг WiFi:

   ```bash
   copy config_private.h.example config_private.h
   ```

2. Открой `config_private.h` и заполни:

   | Параметр    | Пример            | Описание                        |
   | ----------- | ----------------- | ------------------------------- |
   | `WIFI_SSID` | `"MyWiFi"`        | Имя точки доступа               |
   | `WIFI_PASS` | `"MyPassword"`    | Пароль WiFi                     |
   | `PC_IP`     | `"192.168.1.100"` | **IPv4-адрес ПК** в той же сети |
   | `TCP_PORT`  | `8888`            | Порт (такой же, как в `.env`)   |

   Важно: `PC_IP` — это IP твоего компьютера, который ты узнал на шаге 2. Плата будет подключаться по TCP к этому адресу и порту.

3. Для прошивки нужны: **main.cpp**, **platformio.ini** (или настройки платы в Arduino IDE), скопированный **config_private.h**.
4. Открой проект в **PlatformIO** (файл `platformio.ini` в корне), выбери плату `heltec_wifi_lora_32_V3` (или совместимую ESP32 с SSD1306), собери и залей прошивку. Либо открой **main.cpp** в Arduino IDE, выбери плату Heltec WiFi Kit 32, собери и залей.

---

## Шаг 5. Подключение и проверка

1. Убедись, что на ПК запущен **monitor.py** или **monitor.exe** (в трее — иконка «Heltec Monitor»).
2. Плата должна быть включена и в зоне WiFi.
3. Через несколько секунд после загрузки прошивки Heltec подключится к WiFi и к TCP-серверу.
4. На дисплее появятся экраны с метриками. В правом верхнем углу будет «W» (WiFi).

Если данные не появляются:

- Проверь, что LibreHardwareMonitor запущен и веб-сервер включён.
- Проверь, что `PC_IP` в `config_private.h` совпадает с реальным IP ПК.
- Убедись, что брандмауэр не блокирует входящие на порт 8888 (или отключи его для теста).
- В консоли monitor.py при подключении платы должно появиться: `[TCP] Подключён ...`

---

## Шаг 6. Управление на дисплее

- **Короткое нажатие** кнопки — переключение экранов (Main → Cores → GPU → … → Network → Wolf & Moon → снова Main).
- **Долгое нажатие** — открыть меню. На экране Wolf & Moon долгое нажатие >1.5 с выходит из игры и переключает на следующий экран.
- В меню:
  - Короткое нажатие — переход по пунктам (LED → AUTO → Bright → Intvl → EQ → EXIT).
  - Долгое нажатие на пункте — изменить значение (вкл/выкл LED, автосмену; контраст 128/192/255; интервал карусели 5/10/15 с; стиль эквалайзера) или выйти (EXIT).

Меню само закроется через 5 минут без действий.

---

## Дальше

- **Автозапуск монитора:** [AUTOSTART.md](AUTOSTART.md)
- **Один EXE вместо Python:** выполни `build_oneclick.bat` — в корне появится `monitor.exe`. Положи рядом `.env` (скопируй из `.env.example` при необходимости) и запускай. EXE работает без окна консоли, только иконка в трее; выход — правый клик по иконке → Выход.

Готово. Если что-то пошло не так — сверься с [README.md](README.md) и проверь конфиги и порты.
